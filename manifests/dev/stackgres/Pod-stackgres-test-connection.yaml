apiVersion: v1
kind: Pod
metadata:
  annotations:
    helm.sh/hook: test
  labels:
    app: stackgres
    group: helm-tests
  name: stackgres-test-connection
  namespace: stackgres
spec:
  containers:
    - command:
        - bash
        - -xe
        - -c
        - |
          POD_NAME=$(kubectl get pod -n stackgres -o name | grep -v stackgres-test-connection | grep stackgres)
          POD_IP=$(kubectl get ${POD_NAME} -n stackgres -o jsonpath="{ .status.podIP }")
          curl -v ${POD_IP}:8080/q/health/live
      image: quay.io/ongres/kubectl:v1.31.3-build-6.38
      imagePullPolicy: IfNotPresent
      name: conn-check
  restartPolicy: Never
  securityContext:
    fsGroup: 1000
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000
  serviceAccountName: stackgres
  terminationGracePeriodSeconds: 0
